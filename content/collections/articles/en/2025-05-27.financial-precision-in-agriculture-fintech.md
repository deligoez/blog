---
id: 07b11a80-824a-42ce-a84d-8b5fcad94cc4
blueprint: articles
title: 'Financial Precision in Agriculture Fintech'
subtitle: 'Our Journey from 2 to 16 Decimal Places'
updated_by: b8f3533e-0fcf-42b9-a3d8-c8691deaf917
updated_at: 1748363482
content:
  -
    type: paragraph
    content:
      -
        type: text
        text: 'At '
      -
        type: text
        marks:
          -
            type: link
            attrs:
              href: 'https://www.tarfin.com'
              rel: null
              target: null
              title: null
        text: Tarfin
      -
        type: text
        text: ", thousands of farmers have chosen us to purchase their seeds, fertilizers, feed and equipment and conveniently pay after harvest. Founded in 2017 in Turkey, we help farmers across 75+ cities by letting them compare prices from 900 retailers and purchase agri-inputs without tying up their cash. Since 2021, we've expanded to Romania, bringing the same pay-at-harvest model to help small and medium-sized farmers access agricultural inputs without guarantees or hidden costs."
  -
    type: paragraph
    content:
      -
        type: text
        text: "When we started building our system, we followed the best practices known at the time: storing monetary values as integers in the database to avoid floating-point rounding issues. However, as our business grew and became more sophisticated, we discovered that even this approach wasn't sufficient. This article shares our journey of migrating from 2 decimal precision to a "
      -
        type: text
        marks:
          -
            type: code
        text: 'DECIMAL(29,16)'
      -
        type: text
        text: " structure in our database - that's 29 digits before the decimal point and 16 after."
  -
    type: set
    attrs:
      id: mb6q56ay
      values:
        type: heading
        heading: 'The Foundation: Brick/Money Library'
  -
    type: paragraph
    content:
      -
        type: text
        text: 'After experiencing the limitations of integer storage, we adopted the '
      -
        type: text
        marks:
          -
            type: link
            attrs:
              href: 'https://github.com/brick/money'
              rel: null
              target: null
              title: null
        text: Brick/Money
      -
        type: text
        text: ' library for all monetary operations in our Laravel application:'
  -
    type: set
    attrs:
      id: mb6q63us
      values:
        type: code
        code: |-
          ```php
          use Brick\Money\Money;
          use Brick\Money\Context\CustomContext;

          // Before: 2 decimal precision
          $context2 = new CustomContext(2);
          $price = Money::of('999.99', 'TRY', $context2);

          // After: 16 decimal precision
          $context16 = new CustomContext(16);
          $price = Money::of('999.9999999999999999', 'TRY', $context16);
          $commission = $price->multipliedBy('0.025'); // 2.5% commission
          ```
  -
    type: set
    attrs:
      id: mb6q6yi2
      values:
        type: heading
        heading: 'Our Starting Point: Integer Storage Instead of Float'
  -
    type: paragraph
    content:
      -
        type: text
        text: 'When we started building Tarfin, we knew about the dangers of floating-point arithmetic. The classic example every developer learns:'
  -
    type: set
    attrs:
      id: mb6q7g12
      values:
        type: code
        code: |-
          ```php
          // The famous floating-point precision problem
          $a = 0.1;
          $b = 0.2;
          $sum = $a + $b;

          var_dump($sum === 0.3); // false!
          printf("%.17f", $sum);  // 0.30000000000000004
          ```
  -
    type: paragraph
    content:
      -
        type: text
        text: 'This happens because computers store floating-point numbers in binary (base 2), and many decimal fractions cannot be represented exactly in binary. Just like 1/3 cannot be precisely represented in decimal (0.333...), 0.1 cannot be precisely represented in binary.'
  -
    type: paragraph
    content:
      -
        type: text
        text: "That's why we followed the best practice of storing monetary values as integers:"
  -
    type: set
    attrs:
      id: mb6q8kzn
      values:
        type: code
        code: |-
          ```php
          // Instead of storing 100.50 TRY as float
          $price = 100.50; // Dangerous!

          // We stored it as integer kuruş
          $priceInKurus = 10050; // Safe from floating-point errors
          ```
  -
    type: set
    attrs:
      id: mb6q8zw7
      values:
        type: heading
        heading: 'Why Integer Storage Was Our First Step Away from Floats'
  -
    type: paragraph
    content:
      -
        type: text
        text: 'The integer storage approach had several advantages over floats:'
  -
    type: set
    attrs:
      id: mb6q9ev4
      values:
        type: heading
        number: 1
        heading: 'Exact Representation'
  -
    type: set
    attrs:
      id: mb6q9oll
      values:
        type: code
        code: |-
          ```php
          // Float storage problems
          $dbPrice = 19.99;
          $quantity = 3;
          $total = $dbPrice * $quantity; // 59.97... or is it?
          printf("%.17f", $total); // 59.96999999999999886

          // Integer storage (kuruş)
          $dbPriceKurus = 1999;
          $quantity = 3;
          $totalKurus = $dbPriceKurus * $quantity; // Exactly 5997
          $totalTRY = $totalKurus / 100; // 59.97
          ```
  -
    type: set
    attrs:
      id: mb6qakuq
      values:
        type: heading
        number: 2
        heading: 'Consistent Database Operations'
  -
    type: set
    attrs:
      id: mb6qavxs
      values:
        type: code
        code: |-
          ```sql
          -- Float columns can have comparison issues
          SELECT * FROM orders WHERE total = 59.97; -- Might miss rows!

          -- Integer columns are reliable
          SELECT * FROM orders WHERE total_kurus = 5997; -- Always works
          ```
  -
    type: set
    attrs:
      id: mb6qb72p
      values:
        type: heading
        number: 3
        heading: 'No Accumulating Errors'
  -
    type: set
    attrs:
      id: mb6qbj33
      values:
        type: code
        code: |-
          ```php
          // Float accumulation problem
          $balance = 0.0;
          for ($i = 0; $i < 10000; $i++) {
              $balance += 0.01;
          }
          echo $balance; // 99.99999999999991 (should be 100.00)

          // Integer accumulation is perfect
          $balanceKurus = 0;
          for ($i = 0; $i < 10000; $i++) {
              $balanceKurus += 1;
          }
          echo $balanceKurus / 100; // Exactly 100.00
          ```
  -
    type: paragraph
    content:
      -
        type: text
        text: 'This integer approach worked well for amounts with 2 decimal places, but our business requirements soon exceeded these limitations.'
  -
    type: set
    attrs:
      id: mb6qc8bi
      values:
        type: heading
        heading: "Why 2 Decimal Places Weren't Enough"
  -
    type: set
    attrs:
      id: mb6qchoi
      values:
        type: heading
        heading: '- Real-World Problem: Income Protected Sales (IPS)'
  -
    type: paragraph
---
