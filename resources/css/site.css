@import './fonts/equity-text-a-normal.css';
@import './fonts/equity-text-a-bold.css';
@import './fonts/equity-text-a-italic.css';
@import './fonts/equity-text-a-bold-italic.css';
@import './fonts/equity-caps-a-normal.css';
@import './fonts/equity-caps-a-bold.css';
@import './fonts/concourse-t3-index.css';
@import './fonts/iosevka.css';
@import './syntax-highlight.css';

@import "tailwindcss";

/* Enable class-based dark mode for Tailwind v4 */
@custom-variant dark (&:where(.dark, .dark *));

/* Hide elements until Alpine.js initializes */
[x-cloak] {
    display: none !important;
}

/* Prevent horizontal scroll from sidenotes */
html {
    overflow-x: clip;
}

@theme {
    /* Custom Font Families */
    --font-serif: 'Equity Text A', 'Times New Roman', Times, Georgia, Cambria, ui-serif, serif;
    --font-caps: 'Equity Caps A', serif;
    --font-index: 'concourse-t3-index', sans;
    --font-mono: 'Iosevka', monospace;

    /* Custom Animation: Wiggle */
    --animate-wiggle: wiggle 1s ease-in-out infinite;

    @keyframes wiggle {
        0%, 100% { transform: rotate(-3deg); }
        50% { transform: rotate(3deg); }
    }

    /* Left margin for left-anchored layout */
    --layout-margin: clamp(1rem, 1.5vw, 1.5rem);

    /* Sidebar (A section) - grows with viewport, has max */
    --sidebar-width: clamp(12rem, 20vw, 20rem);
    --sidebar-gap: clamp(1.5rem, 2vw, 3rem);

    /* Content max width */
    --container-content: clamp(32rem, 50vw, 56rem);
}

@layer base {
    /* Remove paragraph wrapper from markdown in titles */
    .title-markdown > p {
        display: contents;
    }

    p > a {
        @apply font-caps font-bold text-[1.55rem] no-underline tracking-wide hover:bg-gray-200 dark:hover:bg-gray-700 py-1 px-2 transition duration-200 rounded-lg;
        vertical-align: 0em;
    }

    ol {
        counter-reset: count;
        @apply ml-12 my-4;
    }

    ul {
        @apply ml-12 my-4;
    }

    ol > li, ul > li {
        @apply list-none my-4;
    }

    ol > li:before {
        counter-increment: count;
        content: counter(count);
        @apply font-index text-[1.625rem] absolute -ml-8 mt-1;
    }

    ul > li:before {
        content: "•";
        @apply text-[1.625rem] absolute -ml-8;
    }

    /* Blockquote - Article quotes/citations */
    .article-content blockquote {
        @apply relative py-4 px-10 italic max-w-[85%];
        margin-top: 4rem !important;
        margin-bottom: 3rem !important;
        font-size: 1.1em;
    }

    .article-content blockquote::before {
        content: "\201C";
        @apply absolute -left-2 -top-6 text-6xl text-gray-300 dark:text-gray-600 leading-none font-serif;
    }

    .article-content blockquote::after {
        content: "\201D";
        @apply absolute right-4 -bottom-6 text-6xl text-gray-300 dark:text-gray-600 leading-none font-serif;
    }

    .article-content blockquote p {
        @apply text-gray-600 dark:text-gray-300 relative z-10;
    }

    /* Thought - Inner monologue / thought bubble */
    .thought {
        @apply my-8 flex;
    }

    .thought-left {
        @apply justify-start;
    }

    .thought-right {
        @apply justify-end;
    }

    .thought-center-left {
        @apply justify-start;
    }

    .thought-center-left .thought-bubble {
        margin-left: auto;
        margin-right: 50%;
    }

    .thought-center-right {
        @apply justify-start;
    }

    .thought-center-right .thought-bubble {
        margin-left: 50%;
        margin-right: auto;
    }

    .thought-bubble {
        @apply relative bg-gray-100 dark:bg-gray-800 py-4 px-6 rounded-3xl max-w-[80%];
    }

    /* Left bubble tail */
    .thought-bubble-left::before {
        content: "";
        @apply absolute -bottom-2 left-8 w-4 h-4 bg-gray-100 dark:bg-gray-800 rounded-full;
    }

    .thought-bubble-left::after {
        content: "";
        @apply absolute -bottom-5 left-5 w-2.5 h-2.5 bg-gray-100 dark:bg-gray-800 rounded-full;
    }

    /* Right bubble tail */
    .thought-bubble-right::before {
        content: "";
        @apply absolute -bottom-2 right-8 w-4 h-4 bg-gray-100 dark:bg-gray-800 rounded-full;
    }

    .thought-bubble-right::after {
        content: "";
        @apply absolute -bottom-5 right-5 w-2.5 h-2.5 bg-gray-100 dark:bg-gray-800 rounded-full;
    }

    /* Center-left bubble tail (points left, towards edge) */
    .thought-bubble-center-left::before {
        content: "";
        @apply absolute -bottom-2 left-8 w-4 h-4 bg-gray-100 dark:bg-gray-800 rounded-full;
    }

    .thought-bubble-center-left::after {
        content: "";
        @apply absolute -bottom-5 left-5 w-2.5 h-2.5 bg-gray-100 dark:bg-gray-800 rounded-full;
    }

    /* Center-right bubble tail (points right, towards edge) */
    .thought-bubble-center-right::before {
        content: "";
        @apply absolute -bottom-2 right-8 w-4 h-4 bg-gray-100 dark:bg-gray-800 rounded-full;
    }

    .thought-bubble-center-right::after {
        content: "";
        @apply absolute -bottom-5 right-5 w-2.5 h-2.5 bg-gray-100 dark:bg-gray-800 rounded-full;
    }

    .thought-content {
        @apply italic text-gray-500 dark:text-gray-400;
    }

    .thought-bubble-left .thought-content {
        @apply text-left;
    }

    .thought-bubble-right .thought-content {
        @apply text-right;
    }

    .thought-bubble-center-left .thought-content {
        @apply text-left;
    }

    .thought-bubble-center-right .thought-content {
        @apply text-right;
    }

    /* Horizontal Rule - Subtle wavy divider */
    .article-content hr {
        @apply my-12 border-0 h-6 bg-transparent;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 10' preserveAspectRatio='none'%3E%3Cpath d='M0 5 Q 12.5 0, 25 5 T 50 5 T 75 5 T 100 5' stroke='%23d1d5db' stroke-width='1' fill='none'/%3E%3C/svg%3E");
        background-repeat: repeat-x;
        background-position: center;
        background-size: 100px 10px;
    }

    .dark .article-content hr {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 10' preserveAspectRatio='none'%3E%3Cpath d='M0 5 Q 12.5 0, 25 5 T 50 5 T 75 5 T 100 5' stroke='%234b5563' stroke-width='1' fill='none'/%3E%3C/svg%3E");
    }

    /* Tables - Minimal, relaxed design with inner borders */
    .article-content table {
        @apply w-full my-8 text-left;
        border-collapse: collapse;
    }

    .article-content th {
        @apply font-caps font-semibold text-gray-700 dark:text-gray-200 py-3 px-4;
        font-size: 0.9em;
        letter-spacing: 0.02em;
    }

    .article-content td {
        @apply py-3 px-4 text-gray-600 dark:text-gray-300;
    }

    .article-content td:first-child {
        @apply font-medium text-gray-800 dark:text-gray-100;
    }

    /* Inner borders only - between columns */
    .article-content th:not(:last-child),
    .article-content td:not(:last-child) {
        @apply border-r border-gray-200 dark:border-gray-700;
    }

    /* Inner borders only - between rows (not after header, not after last row) */
    .article-content tbody tr:not(:last-child) td {
        @apply border-b border-gray-200 dark:border-gray-700;
    }

    /* Header bottom border - slightly stronger */
    .article-content thead th {
        @apply border-b border-gray-300 dark:border-gray-600;
    }

    /* Sidenote - Tufte-style margin notes */
    .sidenote {
        @apply leading-relaxed my-4 py-3 px-4 rounded-lg border-l-2 relative;
        font-size: 1em;
    }

    .sidenote-icon {
        @apply w-5 h-5 inline-block mr-2 align-text-bottom flex-shrink-0;
    }

    .sidenote-content {
        @apply italic;
    }

    /* Sidenote styles - all use same minimal gray styling */
    .sidenote-note,
    .sidenote-info,
    .sidenote-tip,
    .sidenote-warning,
    .sidenote-danger {
        @apply text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 border-gray-300 dark:border-gray-600;
    }

    /* Sidenote type icons - centered on border */
    .sidenote-type-icon {
        @apply w-6 h-6 absolute text-gray-400 dark:text-gray-500 pointer-events-none bg-gray-50 dark:bg-gray-800;
        top: 50%;
        transform: translateY(-50%);
    }

    .sidenote-type-icon-right {
        @apply -left-3;
    }

    .sidenote-type-icon-left {
        @apply -right-3;
    }

    /* Wide screens (1280px+): position sidenotes in the margin */
    @media (min-width: 1280px) {
        .article-content {
            @apply relative;
        }

        .sidenote {
            @apply absolute my-0 leading-snug;
            /* Fluid width: wider sidenotes */
            width: clamp(14rem, 17vw, 32rem);
            font-size: clamp(0.85em, 0.75em + 0.2vw, 1.05em);
        }

        /* All sidenote styles: minimal in margin */
        .sidenote-note,
        .sidenote-info,
        .sidenote-tip,
        .sidenote-warning,
        .sidenote-danger {
            @apply bg-transparent py-0 px-3 border-0 rounded-none;
        }

        .sidenote-right {
            /* Position scales with width */
            right: clamp(-34rem, -18vw, -15rem);
            @apply border-l-2 border-r-0;
        }

        .sidenote-left {
            left: clamp(-34rem, -18vw, -15rem);
            @apply text-right border-r-2 border-l-0;
        }
    }

    /* Code blocks - Iosevka font */
    code {
        @apply font-mono leading-relaxed;
    }

    /* Inline code */
    p > code,
    li > code {
        @apply py-0.5 px-2 rounded bg-gray-100 dark:bg-gray-800 text-[0.85em];
    }

    a > code,
    h1 > code,
    h2 > code {
        @apply py-0.5 px-2 rounded bg-gray-200 dark:bg-gray-700 text-[0.80em];
    }

    /* Pre blocks (code blocks) */
    pre {
        @apply leading-relaxed;
    }

    pre code {
        /* Fixed size for code blocks - adjust this value to make code smaller/larger */
        font-size: clamp(0.9rem, 0.8rem + 0.25vw, 1.05rem);
    }

    .article-content pre code {
        /* Override for article content - scales from 0.9rem on mobile to 1.25rem on desktop */
        font-size: clamp(0.9rem, 0.65rem + 0.45vw, 1.25rem);
    }

    /* Native markdown headings in article content - match custom heading set style */
    .article-content h1,
    .article-content h2,
    .article-content h3,
    .article-content h4 {
        @apply font-caps;
        @apply block pb-2.5 leading-snug font-serif cursor-pointer;
        @apply border-b-2 border-transparent hover:border-black dark:hover:border-white transition duration-200;
    }

    /* Scroll to top button for article headings */
    .scroll-to-top-btn {
        @apply inline-flex items-center ml-2 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors cursor-pointer relative;
        vertical-align: middle;
    }

    .scroll-to-top-btn svg {
        width: 0.8em;
        height: 0.8em;
    }

    /* Custom fast tooltip */
    .scroll-to-top-btn::after {
        content: attr(data-tooltip);
        @apply absolute left-1/2 -translate-x-1/2 bottom-full mb-1 px-2 py-1 text-xs rounded bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-100;
    }

    .scroll-to-top-btn:hover::after {
        @apply opacity-100;
    }

    /* Heading anchor links - inherit heading style */
    .article-content h1 > a,
    .article-content h2 > a,
    .article-content h3 > a,
    .article-content h4 > a {
        @apply text-inherit no-underline hover:no-underline;
        font-size: inherit;
        font-weight: inherit;
    }

    .article-content h1 {
        @apply font-semibold text-4xl mt-10;
    }

    .article-content h2 {
        @apply font-semibold text-3xl mt-8;
    }

    .article-content h3 {
        @apply font-semibold text-2xl mt-6;
    }

    .article-content h4 {
        @apply font-semibold text-xl mt-4;
    }

    /* Mobile: center headings and justify paragraphs in article content */
    @media (max-width: 767px) {
        .article-content h1,
        .article-content h2,
        .article-content h3,
        .article-content h4,
        .article-content h5,
        .article-content h6 {
            @apply text-center;
        }

        .article-content p {
            @apply text-justify;
        }
    }
}

@layer components {
    /* Table of Contents - Compact Style */
    .toc-compact .toc-list,
    .toc-auto .toc-list {
        @apply ml-0 my-2 italic;
    }

    .toc-compact .toc-list li,
    .toc-auto .toc-list li {
        @apply list-none my-0.5 leading-snug;
    }

    .toc-compact .toc-list li:before,
    .toc-auto .toc-list li:before {
        content: none;
    }

    .toc-auto .toc-list a {
        @apply no-underline;
    }

    /* Sidebar TOC - Table of Contents */
    .toc-sidebar {
        @apply mt-6 pt-4 border-t border-gray-200 dark:border-gray-700;
    }

    .toc-sidebar-title {
        @apply font-caps uppercase tracking-widest text-gray-400 dark:text-gray-500 mb-2 text-right pr-6;
        font-size: clamp(0.875rem, 0.7rem + 0.4vw, 1.125rem);
    }

    .toc-sidebar-list {
        @apply ml-0 my-0;
    }

    .toc-sidebar-list > li {
        @apply list-none relative;
        font-size: clamp(0.9rem, 0.75rem + 0.35vw, 1.15rem);
        line-height: 1.2;
        margin: 0 0 clamp(0.2rem, 0.4vh, 1rem) 0 !important;
        padding: 0;
    }

    .toc-sidebar-list > li:before {
        content: none;
    }

    .toc-sidebar-item a {
        @apply text-gray-500 dark:text-gray-400 no-underline hover:text-black dark:hover:text-white transition-colors duration-200 block text-right;
        font-size: inherit;
        font-weight: normal;
        padding-right: 1.25rem;
    }

    /* H1 items get a bullet on the right - fixed position */
    .toc-sidebar-level-1::after {
        content: "›";
        @apply absolute right-0 top-0 text-gray-400 dark:text-gray-500;
    }

    /* Indentation for heading levels (right-aligned, so padding on right) */
    .toc-sidebar-level-2 a {
        @apply pr-5;
    }

    .toc-sidebar-level-3 a {
        @apply pr-7;
    }

    .toc-sidebar-level-4 a {
        @apply pr-9;
    }

    /* Hide TOC on mobile only - show after md breakpoint */
    @media (max-width: 767px) {
        .toc-sidebar {
            display: none;
        }
    }

    /* Article Layout Container - left-anchored */
    .article-container {
        margin-left: var(--layout-margin);
        margin-right: var(--layout-margin);
    }

    /* Header aligned with article content - for show/listing pages */
    .header-content-aligned {
        margin-left: var(--layout-margin);
        margin-right: var(--layout-margin);
        /* Left padding matches sidebar width + gap, so nav starts at content edge */
        padding-left: calc(var(--sidebar-width) + var(--sidebar-gap));
    }

    /* Sidebar styles */
    .article-sidebar {
        width: var(--sidebar-width);
        flex-shrink: 0;
        margin-right: var(--sidebar-gap);
        align-self: flex-start;
        position: sticky;
        top: 2rem;
        max-height: calc(100vh - 4rem);
        overflow: visible; /* Allow logo to extend above */
    }

    /* TOC section scrollable */
    .toc-sidebar {
        max-height: calc(100vh - 20rem);
        overflow-y: auto;
    }

    /* Sidebar logo - positioned to align with header nav */
    .article-sidebar-logo {
        margin-top: -6rem; /* Pull logo up to align with nav */
        margin-bottom: 1.5rem; /* Space between logo and title */
    }

    .article-sidebar-logo svg {
        height: clamp(2.5rem, 4vw, 3.5rem);
        width: auto;
    }

    /* Content area */
    .article-content {
        flex: 1;
        max-width: var(--container-content);
        /* Fluid typography: scales from 1.125rem at 640px to 1.5rem at 1536px */
        font-size: clamp(1.125rem, 0.9rem + 0.5vw, 1.5rem);
        line-height: 1.5;
    }

    /* Wide screens (1280px+): leave room for sidenotes on the right */
    @media (min-width: 1280px) {
        .article-container {
            margin-right: 0; /* No right margin - sidenotes use all space */
            /* Padding scales with sidenote width */
            padding-right: clamp(15rem, 18vw, 34rem);
        }
    }

    /* Fluid heading sizes */
    .fluid-title {
        font-size: clamp(1.5rem, 1rem + 1.5vw, 2rem);
        line-height: 1.2;
    }

    .fluid-subtitle {
        font-size: clamp(1.25rem, 0.875rem + 1vw, 1.5rem);
        line-height: 1.3;
    }

    .fluid-meta {
        font-size: clamp(1rem, 0.75rem + 0.5vw, 1.25rem);
    }

    /* Mobile article header - larger sizes for top placement */
    .fluid-mobile-title {
        font-size: clamp(1.875rem, 1.25rem + 2vw, 2.5rem);
        line-height: 1.15;
    }

    .fluid-mobile-subtitle {
        font-size: clamp(1.375rem, 1rem + 1.25vw, 1.75rem);
        line-height: 1.25;
    }

    /* Home page specific */
    .home-container {
        max-width: clamp(40rem, 75vw, 64rem);
        margin-inline: auto;
    }

    .fluid-hero {
        font-size: clamp(1.75rem, 1rem + 2.5vw, 3rem);
    }

    .fluid-name {
        font-size: clamp(1.5rem, 0.875rem + 2vw, 3rem);
    }

    .fluid-section-title {
        font-size: clamp(1.25rem, 0.75rem + 1.5vw, 1.875rem);
    }

    .fluid-article-title {
        font-size: clamp(1.25rem, 0.875rem + 1.25vw, 1.875rem);
    }

    /* Fluid menu text - scales with viewport */
    .fluid-menu {
        font-size: clamp(1.25rem, 0.75rem + 1vw, 2rem);
    }

    /* Sticky Article Header - appears on scroll */
    .sticky-article-header {
        @apply fixed top-0 left-0 right-0 z-50 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm;
        @apply border-b border-gray-200 dark:border-gray-700;
        @apply py-3 px-4 md:px-8 lg:px-16;
    }

    .sticky-header-content {
        @apply flex items-center justify-start max-w-screen-2xl mx-auto;
    }

    .sticky-header-logo {
        @apply flex-shrink-0 mr-4;
    }

    .sticky-header-logo svg {
        height: clamp(1.5rem, 2vw, 2rem);
        width: auto;
    }

    .sticky-header-title {
        @apply font-semibold truncate mr-4;
        font-size: clamp(1.25rem, 0.9rem + 1vw, 1.75rem);
        line-height: 1.2;
    }

    .sticky-header-title > p {
        display: contents;
    }

    .sticky-header-toc {
        @apply relative flex-shrink-0;
    }

    .sticky-header-toc-btn {
        @apply flex items-center font-caps text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors;
        font-size: clamp(0.875rem, 0.7rem + 0.35vw, 1rem);
    }

    .sticky-header-toc-dropdown {
        @apply absolute right-0 top-full mt-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700;
        @apply p-4 min-w-64 max-h-96 overflow-y-auto;
    }

    .sticky-header-toc-dropdown .toc-sidebar {
        @apply mt-0 pt-0 border-t-0;
    }

    .sticky-header-toc-dropdown .toc-sidebar-title {
        @apply text-left pr-0;
    }

    .sticky-header-toc-dropdown .toc-sidebar-item a {
        @apply text-left pr-0;
    }

    .sticky-header-toc-dropdown .toc-sidebar-level-1::after {
        @apply left-auto right-auto;
        content: none;
    }

    /* Sidebar scroll behavior */
    .article-sidebar-scrollable {
        position: relative;
        top: auto;
        @apply transition-all duration-500 ease-out;
    }

    .sidebar-hidden {
        @apply opacity-0 pointer-events-none;
        width: 0 !important;
        margin-right: 0 !important;
        overflow: hidden;
    }
}
