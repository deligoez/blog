<div id="top"></div>
<!-- Mobile Sticky Header (appears on scroll) -->
{{ if link }}
<div class="md:hidden sticky-article-header"
     x-data="{ progress: 0 }"
     x-init="window.addEventListener('scroll', () => { progress = Math.min(1, Math.max(0, window.scrollY / 400)) }, { passive: true })"
     x-show="progress > 0.8"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0 -translate-y-4"
     x-transition:enter-end="opacity-100 translate-y-0"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="opacity-100 translate-y-0"
     x-transition:leave-end="opacity-0 -translate-y-4"
     x-cloak>
    <div class="sticky-header-content justify-between">
        <span class="sticky-header-title">{{ emoji }} {{ title }}</span>
        <a href="{{ link }}" target="_blank" rel="noopener noreferrer"
           class="project-external-link inline-flex items-center gap-1 text-gray-500 dark:text-gray-400">
            <span>visit</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
        </a>
    </div>
</div>
{{ /if }}

<!-- Desktop Sticky Header (appears on scroll) -->
<div class="hidden md:block sticky-article-header"
     x-data="{ progress: 0 }"
     x-init="window.addEventListener('scroll', () => { progress = Math.min(1, Math.max(0, window.scrollY / 400)) }, { passive: true })"
     x-show="progress > 0.8"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0 -translate-y-4"
     x-transition:enter-end="opacity-100 translate-y-0"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="opacity-100 translate-y-0"
     x-transition:leave-end="opacity-0 -translate-y-4"
     x-cloak>
    <div class="sticky-header-content">
        <a href="{{ homepage }}" class="sticky-header-logo">
            {{ partial:partials/logo }}
        </a>
        <span class="sticky-header-title">{{ emoji }} {{ title }}</span>
    </div>
</div>

<div class="article-container flex flex-col md:flex-row mt-8 md:mt-12 mb-32 md:mb-52"
     x-data="{ scrollProgress: 0 }"
     x-init="window.addEventListener('scroll', () => { scrollProgress = Math.min(1, Math.max(0, (window.scrollY - 200) / 400)) }, { passive: true })">
    <!-- Mobile Header -->
    <div class="md:hidden mb-8">
        <div class="text-7xl text-center">{{ emoji }}</div>
        <h1 class="fluid-mobile-title font-semibold text-center border-t-[3px] pt-2 border-black dark:border-white mt-4">
            {{ title }}
        </h1>
        <h2 class="mt-3 fluid-mobile-subtitle italic text-center text-gray-600 dark:text-gray-300">
            {{ subtitle }}
        </h2>
        {{ if link }}
        <p class="mt-4 text-sm text-center not-italic">
            <a href="{{ link }}" target="_blank" rel="noopener noreferrer"
               class="project-external-link inline-flex items-center gap-1 text-gray-400 dark:text-gray-500">
                <span>visit project</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
            </a>
        </p>
        {{ /if }}
    </div>

    <!-- Desktop Sidebar (scroll-driven fade out) -->
    <div class="hidden md:flex article-sidebar article-sidebar-scrollable flex-col"
         :style="{ '--scroll-progress': scrollProgress }">
        <!-- Logo above title -->
        <div class="flex justify-end">
            <a href="{{ homepage }}" class="article-sidebar-logo">
                {{ partial:partials/logo }}
            </a>
        </div>
        <div class="text-7xl text-right">{{ emoji }}</div>
        <h1 class="w-full fluid-title font-semibold text-right border-t-[3px] pt-2 border-black dark:border-white mt-4">
            {{ title }}
        </h1>
        <h2 class="w-full mt-3 fluid-subtitle italic text-right dark:text-gray-300">
            {{ subtitle }}
        </h2>
        {{ if link }}
        <p class="w-full mt-4 text-sm text-right not-italic">
            <a href="{{ link }}" target="_blank" rel="noopener noreferrer"
               class="project-external-link inline-flex items-center gap-1 text-gray-400 dark:text-gray-500">
                <span>visit project</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
            </a>
        </p>
        {{ /if }}

        <!-- Sticky TOC -->
        {{ partial:toc-sidebar }}
    </div>

    <!-- Content -->
    <div class="article-content space-y-4 md:space-y-6">
        {{ content }}
            {{ if type == 'set' }}
                {{# Custom bard sets #}}
                {{ partial src="partials/bard/{values:type}" }}
            {{ else }}
                {{# Native bard types (paragraph, heading, list, etc.) #}}
                {{ partial src="partials/bard/{type}" }}
            {{ /if }}
        {{ /content }}
    </div>
</div>
